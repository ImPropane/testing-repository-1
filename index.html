<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoScholar India - Futuristic Scholarship Finder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@700;800;900&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* --- Base Styling & Theme --- */
        :root {
            --bg-deep-space: #12101c;
            --panel-bg: rgba(28, 25, 41, 0.6);
            --accent-primary: #9370db; /* Medium Purple */
            --accent-secondary: #64ffda; /* Soft Teal */
            --border-glow: rgba(147, 112, 219, 0.25);
            --text-primary: #E5E7EB; /* Gray 200 */
            --text-secondary: #9CA3AF; /* Gray 400 */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-deep-space);
            color: var(--text-primary);
        }

        h1, h2, h3, h4, .font-heading {
            font-family: 'Exo 2', sans-serif;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* --- Animated Background --- */
        .main-container::before {
            content: '';
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: 
                linear-gradient(rgba(18, 16, 28, 0.97), rgba(18, 16, 28, 0.97)),
                radial-gradient(ellipse 80% 80% at 20% 110%, var(--accent-primary), transparent),
                radial-gradient(ellipse 80% 80% at 80% -10%, var(--accent-secondary), transparent);
            background-size: 100% 100%, 200% 200%, 200% 200%;
            background-position: 0% 0%, 0% 0%, 100% 100%;
            animation: background-aurora 25s ease-in-out infinite;
            z-index: -2;
            will-change: background-position;
        }

        @keyframes background-aurora {
            0%   { background-position: 0% 0%, 0% 0%, 100% 100%; }
            50%  { background-position: 0% 0%, 100% 100%, 0% 0%; }
            100% { background-position: 0% 0%, 0% 0%, 100% 100%; }
        }
        
        .main-container::after {
            content: '';
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: 
                linear-gradient(var(--border-glow) 1px, transparent 1px),
                linear-gradient(to right, var(--border-glow) 1px, transparent 1px);
            background-size: 50px 50px;
            opacity: 0.05;
            z-index: -1;
        }

        /* --- Glassmorphism Panels --- */
        .glass-panel {
            background: var(--panel-bg);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--border-glow);
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.6), inset 0 0 15px rgba(147, 112, 219, 0.1);
        }
        
        /* --- Form Elements & Inputs --- */
        .form-input {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-glow);
            border-radius: 6px;
            color: var(--text-primary);
            transition: all 0.3s ease;
        }
        .form-input:focus, .form-input:focus-within {
            background: rgba(0,0,0,0.4);
            border-color: var(--accent-primary);
            box-shadow: 0 0 15px var(--border-glow);
            outline: none;
        }
        .form-checkbox {
            color: var(--accent-primary);
            background-color: rgba(0,0,0,0.3);
            border-color: var(--border-glow);
        }
        .form-checkbox:checked {
            background-color: var(--accent-primary);
        }

        /* --- Animations & Transitions --- */
        @keyframes fade-in-up { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in-up { animation: fade-in-up 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }
        
        /* --- Scholarship Card Design --- */
        .result-card {
            opacity: 0;
            transform: translateY(20px);
            transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
            position: relative;
            overflow: hidden;
            border: 1px solid var(--border-glow);
        }
        .result-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--accent-secondary), var(--accent-primary));
            transition: left 0.5s ease;
        }
        .result-card:hover {
            transform: translateY(-10px);
            border-color: var(--accent-primary);
            box-shadow: 0 0 30px var(--border-glow);
        }
        .result-card:hover::before {
            left: 100%;
        }
        .top-match-badge {
            position: absolute;
            top: -1px; right: 15px;
            background: linear-gradient(135deg, var(--accent-secondary), var(--accent-primary));
            color: #12101c;
            padding: 4px 12px;
            font-family: 'Exo 2', sans-serif;
            font-weight: 700;
            font-size: 12px;
            clip-path: polygon(100% 0, 100% 100%, 50% 85%, 0 100%, 0 0);
            text-transform: uppercase;
        }

        /* --- Buttons --- */
        .cyber-button {
            background: linear-gradient(135deg, var(--accent-secondary), var(--accent-primary));
            color: var(--bg-deep-space);
            font-family: 'Exo 2', sans-serif;
            font-weight: 700;
            text-transform: uppercase;
            border: none;
            clip-path: polygon(0 0, 100% 0, 100% 75%, 90% 100%, 0 100%);
            transition: all 0.3s ease;
            position: relative;
        }
        .cyber-button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px var(--border-glow);
        }
        .cyber-button-secondary {
             background: transparent;
             border: 2px solid var(--accent-primary);
             color: var(--accent-primary);
             clip-path: polygon(10% 0, 100% 0, 100% 100%, 0 100%, 0 25%);
        }
         .cyber-button-secondary:hover {
             background: var(--border-glow);
             box-shadow: 0 0 20px var(--border-glow);
         }

        /* --- Custom Scrollbar --- */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-deep-space); }
        ::-webkit-scrollbar-thumb { background: var(--accent-primary); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent-secondary); }
        
        /* --- Tab styling --- */
        .tab-btn { position: relative; }
        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -8px; left: 0; right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-secondary), var(--accent-primary));
            box-shadow: 0 0 10px var(--border-glow);
        }
    </style>
</head>
<body class="font-sans">

    <!-- Login Overlay -->
    <div id="login-overlay" class="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4">
        <div class="glass-panel p-8 md:p-12 rounded-xl w-full max-w-md text-center transform transition-all animate-fade-in-up">
            <h2 class="text-4xl font-black mb-2 tracking-wider text-transparent bg-clip-text bg-gradient-to-r from-[var(--accent-secondary)] to-[var(--accent-primary)]">GOSCHOLAR</h2>
            <p class="text-[var(--text-secondary)] mb-8 font-heading text-sm">ACCESSING SCHOLARSHIP DATABASE...</p>
            <div class="space-y-4">
                <button type="button" id="google-login-btn" class="w-full flex items-center justify-center bg-gray-100 text-gray-800 font-bold py-3 px-4 rounded-md hover:bg-white transition-all duration-300 transform hover:scale-105 shadow-lg">
                    <svg class="w-5 h-5 mr-3" viewBox="0 0 48 48"><path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"></path><path fill="#FF3D00" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"></path><path fill="#4CAF50" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"></path><path fill="#1976D2" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.574l6.19,5.238C42.022,35.421,44,30.038,44,24C44,22.659,43.862,21.35,43.611,20.083z"></path></svg>
                    Authorize with Google
                </button>
                 <button type="button" id="guest-login-btn" class="w-full cyber-button cyber-button-secondary py-3 px-4">
                    Continue as Guest
                </button>
            </div>
        </div>
    </div>

    <!-- Main Application Content -->
    <div id="main-content" class="hidden main-container relative min-h-screen">
        <header class="glass-panel sticky top-0 z-40">
            <div class="container mx-auto px-6 py-4 flex justify-between items-center">
                <h1 class="text-2xl font-black tracking-widest text-transparent bg-clip-text bg-gradient-to-r from-[var(--accent-secondary)] to-[var(--accent-primary)]">GOSCHOLAR</h1>
                <div class="flex space-x-8 items-center">
                    <button id="tab-finder" class="tab-btn px-2 py-1.5 text-sm font-medium transition-colors">Finder</button>
                    <button id="tab-all" class="tab-btn px-2 py-1.5 text-sm font-medium transition-colors">Database</button>
                    <button id="tab-credits" class="tab-btn px-2 py-1.5 text-sm font-medium transition-colors">Credits</button>
                </div>
            </div>
        </header>
        
        <main class="container mx-auto p-4 md:p-8">
            <!-- Finder Tab Content -->
            <div id="finder-content">
                <div class="text-center mb-12 animate-fade-in-up">
                    <h2 class="text-4xl md:text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-[var(--accent-secondary)] to-[var(--accent-primary)] tracking-wide">UNLOCK YOUR POTENTIAL</h2>
                    <p class="mt-4 max-w-2xl mx-auto text-lg text-[var(--text-secondary)]">Calibrate your profile to synchronize with optimal scholarship opportunities.</p>
                </div>

                <div class="glass-panel p-6 md:p-8 rounded-xl mb-12">
                     <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-[var(--text-primary)]">PROFILE CALIBRATION</h2>
                        <button id="clear-form-btn" type="button" title="Reset Profile" class="text-[var(--text-secondary)] hover:text-[var(--accent-primary)] hover:rotate-180 transition-all duration-300">
                            <i data-lucide="refresh-cw" class="w-5 h-5"></i>
                        </button>
                    </div>
                    <form id="scholarship-form">
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            <!-- Academic Details -->
                            <div class="space-y-4 glass-panel p-4 rounded-lg border-l-4 border-[var(--accent-primary)]">
                                <h3 class="text-lg font-bold text-[var(--accent-primary)] flex items-center gap-2"><i data-lucide="graduation-cap"></i>ACADEMIC DATA</h3>
                                <div id="academic-fields-container" class="space-y-4"></div>
                            </div>
                            <!-- Personal & Financial -->
                            <div class="space-y-4 glass-panel p-4 rounded-lg border-l-4 border-[var(--accent-secondary)]">
                                <h3 class="text-lg font-bold text-[var(--accent-secondary)] flex items-center gap-2"><i data-lucide="user-cog"></i>PERSONAL DATA</h3>
                                <div><label for="category" class="block text-sm font-medium text-[var(--text-secondary)] mb-1">Caste Category</label><select id="category" class="form-input w-full p-2"><option value="GENERAL">General</option><option value="OBC">OBC</option><option value="SC">SC</option><option value="ST">ST</option><option value="MINORITY">Minority</option></select></div>
                                <div><label for="income" class="block text-sm font-medium text-[var(--text-secondary)] mb-1">Annual Family Income (₹)</label><input type="number" id="income" placeholder="e.g., 80000" class="form-input w-full p-2"></div>
                                <div><label for="state" class="block text-sm font-medium text-[var(--text-secondary)] mb-1">State of Domicile</label><select id="state" class="form-input w-full p-2"><option value="">Select your State</option></select></div>
                            </div>
                            <!-- Special Categories & Filters -->
                            <div class="space-y-4 glass-panel p-4 rounded-lg border-l-4 border-gray-500">
                                <h3 class="text-lg font-bold text-gray-400 flex items-center gap-2"><i data-lucide="filter"></i>FILTERS</h3>
                                <div class="space-y-3">
                                    <label class="flex items-center"><input type="checkbox" id="exServiceman" class="h-4 w-4 form-checkbox"><span class="ml-3 text-sm text-[var(--text-secondary)]">Ward of Ex-Servicemen</span></label>
                                    <label class="flex items-center"><input type="checkbox" id="farmer" class="h-4 w-4 form-checkbox"><span class="ml-3 text-sm text-[var(--text-secondary)]">Agricultural Background</span></label>
                                    <label class="flex items-center"><input type="checkbox" id="disabled" class="h-4 w-4 form-checkbox"><span class="ml-3 text-sm text-[var(--text-secondary)]">Person with Disability (PwD)</span></label>
                                </div>
                                 <div class="pt-2">
                                     <label class="block text-sm font-medium text-[var(--text-secondary)] mb-2">Scholarship Type</label>
                                    <div class="flex items-center space-x-2 bg-black/20 p-1 rounded-lg">
                                        <label class="flex-1 text-center"><input type="radio" name="scholarshipType" value="All" class="sr-only peer" checked><span class="block px-3 py-1.5 rounded-md cursor-pointer text-xs font-medium peer-checked:bg-gradient-to-r peer-checked:from-[var(--accent-secondary)] peer-checked:to-[var(--accent-primary)] text-gray-300 peer-checked:text-black transition">All</span></label>
                                        <label class="flex-1 text-center"><input type="radio" name="scholarshipType" value="Government" class="sr-only peer"><span class="block px-3 py-1.5 rounded-md cursor-pointer text-xs font-medium peer-checked:bg-gradient-to-r peer-checked:from-[var(--accent-secondary)] peer-checked:to-[var(--accent-primary)] text-gray-300 peer-checked:text-black transition">Govt</span></label>
                                        <label class="flex-1 text-center"><input type="radio" name="scholarshipType" value="Private" class="sr-only peer"><span class="block px-3 py-1.5 rounded-md cursor-pointer text-xs font-medium peer-checked:bg-gradient-to-r peer-checked:from-[var(--accent-secondary)] peer-checked:to-[var(--accent-primary)] text-gray-300 peer-checked:text-black transition">Private</span></label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>

                <div class="border-t-2 border-dashed border-[var(--border-glow)] pt-8">
                    <h2 id="results-title" class="text-3xl font-bold text-gray-200 mb-6 text-center">AWAITING PROFILE DATA...</h2>
                    <div id="results-container" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"></div>
                </div>
            </div>

            <!-- All Scholarships Content -->
            <div id="all-scholarships-content" class="hidden">
                 <div class="mb-8"><h2 class="text-3xl font-bold text-gray-200">SCHOLARSHIP DATABASE</h2><p class="text-[var(--text-secondary)] mt-1">Query the entire archive of scholarship opportunities.</p></div>
                 <div class="relative mb-6"><input type="text" id="all-scholarships-search" placeholder="Enter keywords to query database..." class="w-full pl-12 pr-4 py-3 form-input"><div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none"><i data-lucide="search" class="w-5 h-5 text-gray-500"></i></div></div>
                 <div id="all-scholarships-list" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"></div>
            </div>
            
            <!-- Credits Content -->
            <div id="credits-content" class="hidden">
                 <div class="text-center mb-12"><h2 class="text-4xl md:text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-[var(--accent-secondary)] to-[var(--accent-primary)] tracking-wider">PROJECT CREDITS</h2></div>
                <div class="glass-panel p-8 md:p-12 rounded-xl max-w-2xl mx-auto">
                    <h3 class="text-2xl font-bold text-gray-100 mb-6 text-center">DEVELOPMENT TEAM</h3>
                     <ul class="grid grid-cols-2 gap-4 text-center">
                         <li class="text-lg text-[var(--text-secondary)]">Bhavartha Talvekar</li>
                         <li class="text-lg text-[var(--text-secondary)]">Bhumika Borkar</li>
                         <li class="text-lg text-[var(--text-secondary)]">Dhanasshree Borkar</li>
                         <li class="text-lg text-[var(--text-secondary)]">Dhanashree Mohod</li>
                         <li class="text-lg text-[var(--text-secondary)]">Dnyandeep Dhekle</li>
                         <li class="text-lg text-[var(--text-secondary)]">Gaurav Kale</li>
                     </ul>
                 </div>
            </div>
        </main>

        <footer class="mt-16 py-8 border-t border-[var(--border-glow)]">
            <div class="container mx-auto px-6 text-center text-gray-500">
                <p class="text-sm font-bold text-gray-400 font-heading">DISCLAIMER & INTELLECTUAL PROPERTY NOTICE</p>
                <p class="text-xs mt-2 max-w-4xl mx-auto">
                    This minor project, developed at GH Raisoni Skill Tech University, Nagpur, is the exclusive intellectual property of Bhavartha Talvekar. All source code, logic, and implementation details are authored and maintained solely by me. No part of this project may be copied, reused, distributed, or modified without my explicit personal permission, regardless of access granted by teammates or shared materials. Unauthorized use by juniors, peers, or any third party is strictly prohibited. If I discover that any individual has used or copied this project and falsely claimed it as their own, strict legal action will be taken. For permissions or inquiries, contact me directly at 8459151327.
                </p>
            </div>
        </footer>
    </div>

    <script>
        // --- DATA & CONFIG ---
        const states = ["Andhra Pradesh", "Arunachal Pradesh", "Assam", "Bihar", "Chhattisgarh", "Goa", "Gujarat", "Haryana", "Himachal Pradesh", "Jharkhand", "Karnataka", "Kerala", "Madhya Pradesh", "Maharashtra", "Manipur", "Meghalaya", "Mizoram", "Nagaland", "Odisha", "Punjab", "Rajasthan", "Sikkim", "Tamil Nadu", "Telangana", "Tripura", "Uttar Pradesh", "Uttarakhand", "West Bengal", "Andaman and Nicobar Islands", "Chandigarh", "Dadra and Nagar Haveli and Daman and Diu", "Delhi", "Jammu and Kashmir", "Ladakh", "Lakshadweed", "Puducherry"];
        let scholarships = [];

        // --- UTILITY ---
        const debounce = (func, delay = 400) => { let timeout; return (...args) => { clearTimeout(timeout); timeout = setTimeout(() => { func.apply(this, args); }, delay); }; };
        
        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('guest-login-btn').addEventListener('click', performLogin);
            document.getElementById('google-login-btn').addEventListener('click', () => {
                alert("Sign in with Google is under development. Please continue as a guest.");
            });
        });

        function performLogin() {
            document.getElementById('login-overlay').classList.add('hidden');
            document.getElementById('main-content').classList.remove('hidden');
            initializeApp();
        }

        async function initializeApp() {
            try {
                // IMPORTANT: Replace this with your actual Cloudflare Worker URL
                const response = await fetch("https://goscholar-backend.propane.workers.dev");
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                scholarships = await response.json();
            } catch (error) {
                console.error("Failed to fetch scholarships:", error);
                alert("CRITICAL ERROR: Could not load the scholarship database from the server. The application may not function correctly. See console (F12) for details.");
                scholarships = []; // Fallback to empty list
            }
            
            // Populate states dropdown
            const stateSelect = document.getElementById('state');
            if (stateSelect.options.length <= 1) { states.forEach(state => stateSelect.add(new Option(state, state))); }

            const form = document.getElementById('scholarship-form');
            const debouncedFind = debounce(findScholarships);
            
            form.addEventListener('input', (e) => {
                if (e.target.type === 'number') validateNumberInput(e.target);
                if (e.target.id === 'studyLevel' || e.target.id === 'fieldOfStudy') updateAcademicFields();
                debouncedFind();
            });

            document.getElementById('clear-form-btn').addEventListener('click', () => {
                form.reset();
                updateAcademicFields();
                form.dispatchEvent(new Event('input'));
            });
            
            setupTabs();
            updateAcademicFields();
            findScholarships();
            displayAllScholarships();
            lucide.createIcons();
        }

        // --- FORM LOGIC & DYNAMIC FIELDS ---
        function validateNumberInput(input) {
             let value = parseFloat(input.value);
             const max = parseFloat(input.max);
             if (max && value > max) input.value = max;
        }

        function updateAcademicFields() {
            const container = document.getElementById('academic-fields-container');
            let currentLevel = container.querySelector('#studyLevel')?.value || 'UG';
            let currentField = container.querySelector('#fieldOfStudy')?.value;
            container.innerHTML = '';

            const levelSelectHTML = `<div><label for="studyLevel" class="block text-sm font-medium text-[var(--text-secondary)] mb-1">Current Level of Study</label><select id="studyLevel" class="form-input w-full p-2"><option value="PreMatric">Pre-Matric (Nursery-10)</option><option value="PostMatric">Post-Matric (11-12)</option><option value="UG">Undergraduate (UG)</option><option value="PG">Postgraduate (PG)</option><option value="Doctoral">Doctoral (Ph.D.)</option><option value="PostDoctoral">Post-Doctoral</option></select></div>`;
            container.insertAdjacentHTML('beforeend', levelSelectHTML);
            container.querySelector('#studyLevel').value = currentLevel;

            const fieldGroups = {
                UG: {"General": ["BA", "BSc", "B.Com"], "Technical": ["B.E/B.Tech", "Architecture"], "Medical": ["MBBS", "BDS", "Nursing", "Pharmacy"], "Management/IT": ["BBA", "BCA"], "Other": ["Law", "Education"]},
                PG: {"General": ["MA", "MSc", "M.Com"], "Technical": ["M.Tech"], "Medical": ["MD", "MS"], "Management/IT": ["MBA", "MCA"], "Other": ["LLM", "M.Ed"]},
                Doctoral: { "Research": ["Ph.D.", "M.Phil"] },
                PostDoctoral: { "Research": ["Post-Doctoral"] }
            };

            let fieldOptions = '';
            let fieldDisabled = false;
            
            if (currentLevel === 'PreMatric') {
                fieldDisabled = true; fieldOptions = `<option value="General">General</option>`;
            } else if (currentLevel === 'PostMatric') {
                fieldOptions = `<option value="Science">Science</option><option value="Commerce">Commerce</option><option value="Arts">Arts</option>`;
            } else if (fieldGroups[currentLevel]) {
                Object.entries(fieldGroups[currentLevel]).forEach(([group, opts]) => {
                    fieldOptions += `<optgroup label="${group}">${opts.map(o => `<option value="${o}">${o}</option>`).join('')}</optgroup>`;
                });
            }

            const fieldSelectHTML = `<div><label for="fieldOfStudy" class="block text-sm font-medium text-[var(--text-secondary)] mb-1">Field of Study</label><select id="fieldOfStudy" class="form-input w-full p-2" ${fieldDisabled ? 'disabled' : ''}>${fieldOptions}</select></div>`;
            container.insertAdjacentHTML('beforeend', fieldSelectHTML);
            const fieldSelect = container.querySelector('#fieldOfStudy');
            if (currentField && Array.from(fieldSelect.options).some(o => o.value === currentField)) {
                fieldSelect.value = currentField;
            }
            currentField = fieldSelect.value;

            const createInputHTML = (id, label, placeholder = '', type = 'number', max = 100, step = 1) => `<div><label for="${id}" class="block text-sm font-medium text-[var(--text-secondary)] mb-1">${label}</label><input type="${type}" id="${id}" min="0" max="${max}" step="${step}" placeholder="${placeholder}" class="form-input w-full p-2"></div>`;
            const createSelectHTML = (id, label, options) => `<div><label for="${id}" class="block text-sm font-medium text-[var(--text-secondary)] mb-1">${label}</label><select id="${id}" class="form-input w-full p-2">${options}</select></div>`;
            
            let specificFieldsHTML = '';
            if (['PostMatric', 'UG', 'PG', 'Doctoral', 'PostDoctoral'].includes(currentLevel)) specificFieldsHTML += createInputHTML('marks10', '10th Percentage (%)', 'e.g., 85');
            if (['UG', 'PG', 'Doctoral', 'PostDoctoral'].includes(currentLevel)) specificFieldsHTML += createInputHTML('marks12', '12th Percentage (%)', 'e.g., 85');
            if (['PG', 'Doctoral', 'PostDoctoral'].includes(currentLevel)) specificFieldsHTML += createInputHTML('marksUG', 'UG CGPA / Percentage', 'e.g., 8.5', 'number', 10, 0.1);
            if (['Doctoral', 'PostDoctoral'].includes(currentLevel)) specificFieldsHTML += createInputHTML('marksPG', 'PG Percentage (%)', 'e.g., 75');
            if (currentLevel === 'PreMatric') {
                const classOptions = Array.from({length: 10}, (_, i) => `<option value="${i + 1}">${i + 1}</option>`).join('');
                specificFieldsHTML += createSelectHTML('currentClass', 'Current Class', classOptions);
                specificFieldsHTML += createInputHTML('marksPrev', 'Previous Class %', 'e.g., 90');
            } else if (currentLevel === 'UG' && currentField === "B.E/B.Tech") {
                const semOptions = Array.from({length: 8}, (_, i) => `<option value="${i + 1}">Semester ${i + 1}</option>`).join('');
                specificFieldsHTML += createSelectHTML('currentSemester', 'Current Semester', semOptions);
                specificFieldsHTML += createInputHTML('cgpa', 'Previous Sem CGPA', 'e.g., 8.5', 'number', 10, 0.1);
            }
            container.insertAdjacentHTML('beforeend', specificFieldsHTML);
        }

        // --- UI & TABS ---
        function setupTabs() {
            const tabs = document.querySelectorAll('.tab-btn');
            const contents = [document.getElementById('finder-content'), document.getElementById('all-scholarships-content'), document.getElementById('credits-content')];
            const setActiveTab = (activeIndex) => {
                tabs.forEach((tab, index) => {
                    tab.classList.toggle('active', index === activeIndex);
                    tab.classList.toggle('text-[var(--accent-primary)]', index === activeIndex);
                    tab.classList.toggle('text-[var(--text-secondary)]', index !== activeIndex);
                });
                contents.forEach((content, index) => content.style.display = (index === activeIndex) ? 'block' : 'none');
            };
            tabs.forEach((tab, index) => tab.addEventListener('click', () => setActiveTab(index)));
            setActiveTab(0); // Set initial active tab

            const searchInput = document.getElementById('all-scholarships-search');
            searchInput.addEventListener('input', debounce(() => displayAllScholarships(searchInput.value), 300));
        }
        
        // --- CORE LOGIC: MATCHING & DISPLAY ---
        function calculateMatchScore(scholarship, student) {
            const e = scholarship.eligibility;
            if (e.level && !e.level.includes(student.level)) return 0;
            if (student.scholarshipType !== 'All' && scholarship.type !== student.scholarshipType) return 0;
            if (e.income && student.income > 0 && e.income < student.income) return 0;
            if (e.category && !e.category.includes(student.category)) return 0;
            if (e.stream && !e.stream.includes(student.stream) && !e.stream.includes("All")) return 0;
            if (e.minClass && student.currentClass > 0 && e.minClass > student.currentClass) return 0;
            if (e.maxClass && student.currentClass > 0 && e.maxClass < student.currentClass) return 0;
            if (e.minMarksPrev && student.marksPrev > 0 && e.minMarksPrev > student.marksPrev) return 0;
            if (e.minMarks10 && student.marks10 > 0 && e.minMarks10 > student.marks10) return 0;
            if (e.minMarks12 && student.marks12 > 0 && e.minMarks12 > student.marks12) return 0;
            if (e.minMarksUG && student.marksUG > 0 && e.minMarksUG > student.marksUG) return 0;
            if (e.minMarksPG && student.marksPG > 0 && e.minMarksPG > student.marksPG) return 0;
            if (e.minCGPA && student.cgpa > 0 && e.minCGPA > student.cgpa) return 0;
            if (e.minSemester && student.currentSemester > 0 && e.minSemester > student.currentSemester) return 0;
            if (e.domicile && student.domicile && !e.domicile.includes(student.domicile)) return 0;
            if (e.isDisabled && !student.isDisabled) return 0;
            if (e.isExServiceman && !student.isExServiceman) return 0;
            if (e.isFarmer && !student.isFarmer) return 0;

            let score = 1;
            if (e.domicile && e.domicile.includes(student.domicile)) score += 5;
            if (e.stream && e.stream.includes(student.stream)) score += 5;
            if (e.isDisabled && student.isDisabled) score += 4;
            if (e.isExServiceman && student.isExServiceman) score += 4;
            if (e.isFarmer && student.isFarmer) score += 4;
            return score;
        }

        function findScholarships() {
            const student = {
                level: document.getElementById('studyLevel')?.value,
                stream: document.getElementById('fieldOfStudy')?.value,
                currentClass: parseInt(document.getElementById('currentClass')?.value, 10) || 0,
                currentSemester: parseInt(document.getElementById('currentSemester')?.value, 10) || 0,
                marksPrev: parseInt(document.getElementById('marksPrev')?.value, 10) || 0,
                marks10: parseInt(document.getElementById('marks10')?.value, 10) || 0,
                marks12: parseInt(document.getElementById('marks12')?.value, 10) || 0,
                marksUG: parseInt(document.getElementById('marksUG')?.value, 10) || 0,
                marksPG: parseInt(document.getElementById('marksPG')?.value, 10) || 0,
                cgpa: parseFloat(document.getElementById('cgpa')?.value) || 0,
                scholarshipType: document.querySelector('input[name="scholarshipType"]:checked')?.value || 'All',
                category: document.getElementById('category').value,
                income: parseInt(document.getElementById('income').value, 10) || 0,
                domicile: document.getElementById('state').value,
                isExServiceman: document.getElementById('exServiceman').checked,
                isFarmer: document.getElementById('farmer').checked,
                isDisabled: document.getElementById('disabled').checked
            };

            const scoredScholarships = scholarships
                .map(s => ({ ...s, matchScore: calculateMatchScore(s, student) }))
                .filter(s => s.matchScore > 0)
                .sort((a, b) => b.matchScore - a.matchScore);

            displayResults(scoredScholarships, student);
        }

        function displayResults(results, student) {
            const container = document.getElementById('results-container');
            const title = document.getElementById('results-title');
            container.innerHTML = '';
            
            const hasRequiredInput = student.income > 0 || student.marksPrev > 0 || student.marks10 > 0 || student.marks12 > 0 || student.marksUG > 0 || student.marksPG > 0 || student.cgpa > 0;
            
            if (!hasRequiredInput) {
                title.innerHTML = 'AWAITING PROFILE DATA...';
                container.innerHTML = `<div class="glass-panel p-8 rounded-xl text-center h-full flex flex-col justify-center col-span-1 md:col-span-2 xl:col-span-3"><i data-lucide="scan-line" class="mx-auto h-16 w-16 text-[var(--accent-primary)]" stroke-width="1"></i><h3 class="mt-4 text-xl font-semibold text-[var(--text-primary)] font-heading">Begin Calibration</h3><p class="mt-1 text-[var(--text-secondary)]">Input academic and financial data to initiate search.</p></div>`;
                lucide.createIcons();
                return;
            }
            
            title.innerHTML = `SCAN COMPLETE: <span class="text-transparent bg-clip-text bg-gradient-to-r from-[var(--accent-secondary)] to-[var(--accent-primary)]">${results.length}</span> MATCHES FOUND`;

            if (results.length === 0) {
                container.innerHTML = `<div class="glass-panel p-8 rounded-xl text-center result-card col-span-1 md:col-span-2 xl:col-span-3" style="animation: fade-in-up 0.5s ease-out forwards;"><i data-lucide="shield-x" class="mx-auto h-12 w-12 text-red-400" stroke-width="1.5"></i><h3 class="mt-4 text-xl font-semibold text-[var(--text-primary)] font-heading">No Match Found</h3><p class="mt-1 text-[var(--text-secondary)]">Current profile parameters yield no results. Consider recalibrating your inputs.</p></div>`;
                lucide.createIcons();
                return;
            }
            const maxScore = results.length > 0 ? results[0].matchScore : 0;
            results.forEach((s, index) => container.appendChild(createScholarshipCard(s, index, s.matchScore >= maxScore && maxScore > 5)));
            lucide.createIcons();
        }

        function createScholarshipCard(s, index, isTopMatch = false) {
            const card = document.createElement('div');
            card.className = 'glass-panel p-6 rounded-xl result-card flex flex-col';
            card.style.animation = `fade-in-up 0.5s ease-out ${index * 100}ms forwards`;
            
            const topMatchBadge = isTopMatch ? `<div class="top-match-badge"><i data-lucide="star" class="inline-block w-3 h-3 -mt-0.5 mr-1"></i>Top Match</div>` : '';
            const typeClass = s.type.toLowerCase() === 'private' ? 'text-teal-300 border-teal-500/50' : 'text-purple-300 border-purple-500/50';

            const createEliItem = (icon, text) => `<li class="flex items-start"><i data-lucide="${icon}" class="w-4 h-4 mr-3 mt-0.5 text-[var(--accent-primary)] flex-shrink-0"></i><span>${text}</span></li>`;
            const eligibilityItems = [];
            if(s.eligibility.stream && s.eligibility.stream[0] !== 'All') eligibilityItems.push(createEliItem('award', `Stream: <strong>${s.eligibility.stream.join(', ')}</strong>`));
            if(s.eligibility.minClass && s.eligibility.maxClass) eligibilityItems.push(createEliItem('graduation-cap', `For Classes: <strong>${s.eligibility.minClass} - ${s.eligibility.maxClass}</strong>`));
            if(s.eligibility.category) eligibilityItems.push(createEliItem('users', `Category: <strong>${s.eligibility.category.join(', ')}</strong>`));
            if(s.eligibility.income) eligibilityItems.push(createEliItem('indian-rupee', `Income below: <strong>₹${s.eligibility.income.toLocaleString('en-IN')}</strong>`));
            if(s.eligibility.minMarksPrev) eligibilityItems.push(createEliItem('percent', `Min Prev Class Marks: <strong>${s.eligibility.minMarksPrev}%</strong>`));
            if(s.eligibility.minMarks10) eligibilityItems.push(createEliItem('percent', `Min 10th Marks: <strong>${s.eligibility.minMarks10}%</strong>`));
            if(s.eligibility.minMarks12) eligibilityItems.push(createEliItem('percent', `Min 12th Marks: <strong>${s.eligibility.minMarks12}%</strong>`));
            if(s.eligibility.minMarksUG) eligibilityItems.push(createEliItem('percent', `Min UG Marks: <strong>${s.eligibility.minMarksUG}%</strong>`));
            if(s.eligibility.minMarksPG) eligibilityItems.push(createEliItem('percent', `Min PG Marks: <strong>${s.eligibility.minMarksPG}%</strong>`));
            if(s.eligibility.minCGPA) eligibilityItems.push(createEliItem('percent', `Min CGPA: <strong>${s.eligibility.minCGPA}</strong>`));
            if(s.eligibility.domicile) eligibilityItems.push(createEliItem('map-pin', `Domicile: <strong>${s.eligibility.domicile.join(', ')}</strong>`));

            card.innerHTML = `
                <div class="flex-grow">
                    ${topMatchBadge}
                    <div class="flex justify-between items-start mb-1">
                        <h3 class="text-lg font-bold text-transparent bg-clip-text bg-gradient-to-r from-[var(--accent-secondary)] to-[var(--accent-primary)] pr-4">${s.name}</h3>
                        <span class="inline-block px-2 py-0.5 text-xs font-semibold rounded-full border ${typeClass} flex-shrink-0">${s.type}</span>
                    </div>
                    <p class="text-sm font-medium text-[var(--text-secondary)] mb-3">Portal: ${s.portal}</p>
                    <p class="text-[var(--text-primary)] mb-4 text-sm">${s.description}</p>
                    <div class="border-t border-dashed border-gray-700 pt-3">
                        <h4 class="font-semibold text-gray-200 mb-2 text-sm font-heading">ELIGIBILITY MATRIX:</h4>
                        <ul class="text-sm text-[var(--text-secondary)] space-y-1.5">${eligibilityItems.slice(0, 4).join('')}</ul>
                    </div>
                </div>
                <div class="mt-5 flex-shrink-0">
                    <a href="${s.link}" target="_blank" class="inline-block w-full text-center px-4 py-2.5 text-sm cyber-button">
                        Access Portal <i data-lucide="arrow-right" class="inline-block ml-2 h-4 w-4"></i>
                    </a>
                </div>`;
            return card;
        }
        
        function displayAllScholarships(searchText = "") {
            const container = document.getElementById('all-scholarships-list');
            container.innerHTML = '';
            const lowercasedSearch = searchText.toLowerCase();
            const filtered = scholarships.filter(s => s.name.toLowerCase().includes(lowercasedSearch) || s.portal.toLowerCase().includes(lowercasedSearch) || s.description.toLowerCase().includes(lowercasedSearch));
            
            if (filtered.length === 0) {
                 container.innerHTML = `<div class="md:col-span-2 xl:col-span-3 text-center py-10"><p class="text-gray-500">Query for "${searchText}" returned no results.</p></div>`;
                 return;
            }
            filtered.forEach((s, index) => container.appendChild(createScholarshipCard(s, index)));
            lucide.createIcons();
        }
    </script>
</body>
</html>

